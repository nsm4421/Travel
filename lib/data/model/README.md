# Table

```
CREATE TABLE PUBLIC.ACCOUNTS (
    ID UUID NOT NULL,
    EMAIL TEXT NOT NULL UNIQUE,
    USERNAME TEXT NULL UNIQUE,
    AVATAR_URL TEXT NOT NULL,
    CONSTRAINT ACCOUNTS_PKEY PRIMARY KEY (ID),
    CONSTRAINT ACCOUNTS_FKEY FOREIGN KEY (ID) 
    REFERENCES AUTH.USERS (ID) ON UPDATE CASCADE ON DELETE CASCADE
) TABLESPACE PG_DEFAULT;

ALTER TABLE PUBLIC.ACCOUNTS ENABLE ROW LEVEL SECURITY;

CREATE POLICY "PERMIT SELECT TO AUTHENTICATED" 
ON ACCOUNTS FOR SELECT USING (TRUE);

CREATE POLICY "PERMIT INSERT OWN DATA TO AUTHENTICATED" 
ON ACCOUNTS FOR INSERT TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = ID);

CREATE POLICY "PERMIT UPDATE OWN DATA TO AUTHENTICATED"  
ON ACCOUNTS FOR UPDATE TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = ID);

CREATE POLICY "PERMIT DELETE OWN DATA TO AUTHENTICATED"  
ON ACCOUNTS FOR DELETE TO AUTHENTICATED 
USING (AUTH.UID() = ID);

------------------------------------------------------

CREATE TABLE PUBLIC.FEEDS (
    ID UUID NOT NULL,
    HASHTAGS TEXT[] DEFAULT '{}',
    CAPTIONS TEXT[] DEFAULT '{}',
    IMAGES TEXT[] DEFAULT '{}', 
    -- meta data
    CREATED_BY UUID NOT NULL DEFAULT AUTH.UID(),
    CREATED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    UPDATED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    DELETED_AT TIMESTAMP WITH TIME ZONE DEFAULT NULL,
    CONSTRAINT FEEDS_PKEY PRIMARY KEY (ID),
    CONSTRAINT FEEDS_FKEY FOREIGN KEY (CREATED_BY) 
    REFERENCES PUBLIC.ACCOUNTS (ID) ON UPDATE CASCADE ON DELETE CASCADE
) TABLESPACE PG_DEFAULT;

ALTER TABLE PUBLIC.FEEDS ENABLE ROW LEVEL SECURITY;

CREATE POLICY "PERMIT SELECT TO AUTHENTICATED" 
ON FEEDS FOR SELECT TO AUTHENTICATED USING (TRUE);

CREATE POLICY "PERMIT INSERT OWN DATA TO AUTHENTICATED" 
ON FEEDS FOR INSERT TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT UPDATE OWN DATA TO AUTHENTICATED"  
ON FEEDS FOR UPDATE TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT DELETE OWN DATA TO AUTHENTICATED"  
ON FEEDS FOR DELETE TO AUTHENTICATED 
USING (AUTH.UID() = CREATED_BY);

------------------------------------------------------

CREATE TABLE PUBLIC.REELS (
    ID UUID NOT NULL,
    CAPTION TEXT,
    VIDEO TEXT NOT NULL, 
    -- meta data
    CREATED_BY UUID NOT NULL DEFAULT AUTH.UID(),
    CREATED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    UPDATED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    DELETED_AT TIMESTAMP WITH TIME ZONE DEFAULT NULL,
    CONSTRAINT REELS_PKEY PRIMARY KEY (ID),
    CONSTRAINT REELS_FKEY FOREIGN KEY (CREATED_BY) 
    REFERENCES PUBLIC.ACCOUNTS (ID) ON UPDATE CASCADE ON DELETE CASCADE
) TABLESPACE PG_DEFAULT;

ALTER TABLE PUBLIC.REELS ENABLE ROW LEVEL SECURITY;

CREATE POLICY "PERMIT SELECT TO AUTHENTICATED" 
ON REELS FOR SELECT TO AUTHENTICATED USING (TRUE);

CREATE POLICY "PERMIT INSERT OWN DATA TO AUTHENTICATED" 
ON REELS FOR INSERT TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT UPDATE OWN DATA TO AUTHENTICATED"  
ON REELS FOR UPDATE TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT DELETE OWN DATA TO AUTHENTICATED"  
ON REELS FOR DELETE TO AUTHENTICATED 
USING (AUTH.UID() = CREATED_BY);

------------------------------------------------------

CREATE TABLE PUBLIC.COMMENTS (
    ID UUID NOT NULL,
    PARENT_ID UUID,
    REFERENCE_ID UUID NOT NULL, 
    REFERENCE_TABLE TEXT NOT NULL,
    CONTENT TEXT NOT NULL,
    -- meta data
    CREATED_BY UUID NOT NULL DEFAULT AUTH.UID(),
    CREATED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    UPDATED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    DELETED_AT TIMESTAMP WITH TIME ZONE DEFAULT NULL,
    CONSTRAINT COMMENTS_PKEY PRIMARY KEY (ID),
    CONSTRAINT COMMENTS_FKEY FOREIGN KEY (CREATED_BY) 
    REFERENCES PUBLIC.ACCOUNTS (ID) ON UPDATE CASCADE ON DELETE CASCADE
) TABLESPACE PG_DEFAULT;

ALTER TABLE PUBLIC.COMMENTS ENABLE ROW LEVEL SECURITY;

CREATE POLICY "PERMIT SELECT TO AUTHENTICATED" 
ON COMMENTS FOR SELECT TO AUTHENTICATED USING (TRUE);

CREATE POLICY "PERMIT INSERT OWN DATA TO AUTHENTICATED" 
ON COMMENTS FOR INSERT TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT UPDATE OWN DATA TO AUTHENTICATED"  
ON COMMENTS FOR UPDATE TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT DELETE OWN DATA TO AUTHENTICATED"  
ON COMMENTS FOR DELETE TO AUTHENTICATED 
USING (AUTH.UID() = CREATED_BY);

------------------------------------------------------

CREATE TABLE PUBLIC.EMOTIONS (
    REFERENCE_ID UUID NOT NULL, 
    REFERENCE_TABLE TEXT NOT NULL,
    EMOTION TEXT NOT NULL,
    -- meta data
    CREATED_BY UUID NOT NULL DEFAULT AUTH.UID(),
    CREATED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT EMOTIONS_FKEY FOREIGN KEY (CREATED_BY) 
    REFERENCES PUBLIC.ACCOUNTS (ID) ON UPDATE CASCADE ON DELETE CASCADE,
    UNIQUE(REFERENCE_ID, REFERENCE_TABLE)
) TABLESPACE PG_DEFAULT;

ALTER TABLE PUBLIC.EMOTIONS ENABLE ROW LEVEL SECURITY;

CREATE POLICY "PERMIT SELECT TO AUTHENTICATED" 
ON EMOTIONS FOR SELECT TO AUTHENTICATED USING (TRUE);

CREATE POLICY "PERMIT INSERT OWN DATA TO AUTHENTICATED" 
ON EMOTIONS FOR INSERT TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT UPDATE OWN DATA TO AUTHENTICATED"  
ON EMOTIONS FOR UPDATE TO AUTHENTICATED 
WITH CHECK (AUTH.UID() = CREATED_BY);

CREATE POLICY "PERMIT DELETE OWN DATA TO AUTHENTICATED"  
ON EMOTIONS FOR DELETE TO AUTHENTICATED 
USING (AUTH.UID() = CREATED_BY);
```

# Bucket
```
insert into storage.buckets (id, name)
values ('avatars', 'avatars');

create policy "permit avatar for all" on storage.objects
for select using (bucket_id = 'avatars');

create policy "permit insert avatar for all" on storage.objects
for insert with check (bucket_id = 'avatars');

------------------------------------------------------

insert into storage.buckets (id, name)
values ('feeds', 'feeds');

create policy "permit feed media for all" on storage.objects
for select using (bucket_id = 'feeds');

create policy "permit insert feed media for all" on storage.objects
for insert with check (bucket_id = 'feeds');
------------------------------------------------------

insert into storage.buckets (id, name)
values ('reels', 'reels');

create policy "permit reels media for all" on storage.objects
for select using (bucket_id = 'reels');

create policy "permit insert reels media for all" on storage.objects
for insert with check (bucket_id = 'reels');
```